---
interface Props {
  template: string;
  values: Record<string, string | number>;
  class?: string;
}

const { template, values, class: className = '' } = Astro.props;

// Load SVG template from public/diagrams directory
let svgContent = '';
try {
  const templatePath = `/diagrams/${template}.svg`;
  const response = await fetch(new URL(`../../public${templatePath}`, import.meta.url));
  svgContent = await response.text();
  
  // Replace all placeholders with actual values
  // Placeholders in SVG should be in format: {{PLACEHOLDER_NAME}}
  Object.entries(values).forEach(([key, value]) => {
    const placeholder = new RegExp(`{{${key}}}`, 'g');
    svgContent = svgContent.replace(placeholder, String(value));
  });
} catch (error) {
  console.error(`Failed to load diagram template: ${template}`, error);
  svgContent = '<svg viewBox="0 0 100 100"><text x="50" y="50" text-anchor="middle">Diagram not found</text></svg>';
}
---

<div class={`pattern-diagram ${className}`} set:html={svgContent} />

<style>
  .pattern-diagram {
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
  }
  
  .pattern-diagram :global(svg) {
    width: 100%;
    height: auto;
    display: block;
  }
</style>

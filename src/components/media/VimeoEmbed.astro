---
interface Props {
  vimeoId: string;
  title?: string;
  aspectRatio?: "16:9" | "4:3";
  autoplay?: boolean;
  loop?: boolean;
  muted?: boolean;
}

const { 
  vimeoId, 
  title = "Video", 
  aspectRatio = "16:9",
  autoplay = false,
  loop = false,
  muted = false
} = Astro.props;

const params = new URLSearchParams({
  ...(autoplay && { autoplay: '1' }),
  ...(loop && { loop: '1' }),
  ...(muted && { muted: '1' }),
  byline: '0',
  portrait: '0',
});

const vimeoUrl = `https://player.vimeo.com/video/${vimeoId}?${params.toString()}`;
const paddingBottom = aspectRatio === "16:9" ? "56.25%" : "75%";
---

<div class="vimeo-embed-wrapper" data-testid="video-vimeo">
  <div class="vimeo-embed-container" style={`padding-bottom: ${paddingBottom}`}>
    <iframe
      src={vimeoUrl}
      title={title}
      frameborder="0"
      allow="autoplay; fullscreen; picture-in-picture; clipboard-write"
      allowfullscreen
      loading="lazy"
      aria-label={title}
    ></iframe>
  </div>
</div>

<style>
  .vimeo-embed-wrapper {
    margin: 1rem 0;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px rgba(82, 104, 45, 0.15);
  }

  .vimeo-embed-container {
    position: relative;
    width: 100%;
    height: 0;
    overflow: hidden;
  }

  .vimeo-embed-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }

  @media (max-width: 768px) {
    .vimeo-embed-wrapper {
      margin: 0.75rem 0;
      border-radius: 6px;
    }
  }
</style>

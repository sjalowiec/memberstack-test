---
interface TranscriptSection {
  heading?: string;
  text: string;
}

interface Props {
  title?: string;
  content?: string;
  sections?: TranscriptSection[];
}

const { 
  title = "Read transcript", 
  content,
  sections 
} = Astro.props;

const hasSlotContent = Astro.slots.has('default');
const hasContent = content || (sections && sections.length > 0) || hasSlotContent;
---

{hasContent && (
  <details class="kbm-transcript" data-testid="transcript-details">
    <summary class="kbm-transcript-summary" data-testid="transcript-toggle">
      <span class="kbm-transcript-icon" aria-hidden="true">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
          <polyline points="14 2 14 8 20 8"></polyline>
          <line x1="16" y1="13" x2="8" y2="13"></line>
          <line x1="16" y1="17" x2="8" y2="17"></line>
          <polyline points="10 9 9 9 8 9"></polyline>
        </svg>
      </span>
      {title}
    </summary>
    <div class="kbm-transcript-content" data-testid="transcript-content">
      {hasSlotContent && (
        <div class="kbm-transcript-text">
          <slot />
        </div>
      )}
      {!hasSlotContent && content && (
        <div class="kbm-transcript-text" set:html={content} />
      )}
      {!hasSlotContent && sections && sections.map((section) => (
        <div class="kbm-transcript-section">
          {section.heading && (
            <h4 class="kbm-transcript-heading">{section.heading}</h4>
          )}
          <p class="kbm-transcript-text">{section.text}</p>
        </div>
      ))}
    </div>
  </details>
)}
